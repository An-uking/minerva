(function(){function p(){for(var a=[],b=0,c=arguments.length;b<c;b++)a[b]=arguments[b];postMessage({type:"debug",message:a})}var l=function(){for(var a=[],b=0,c=arguments.length;b<c;b++)a[b]=arguments[b];postMessage({type:"warning",message:a})},q=function(){for(var a=[],b=0,c=arguments.length;b<c;b++)a[b]=arguments[b];postMessage({type:"alert",message:a})},r={DSK:"flex.messaging.messages.AcknowledgeMessageExt",DSA:"flex.messaging.messages.AsyncMessageExt",DSC:"flex.messaging.messages.CommandMessageExt"};
AMF3=function(){this._data=this._rawData=null;this.readObjectCache=[];this.readStringCache=[];this.readTraitsCache=[];this.writeStringCache=[];this.writeObjectCache=[];this.writeTraitsCache=[]};AMF3.prototype={deserialize:function(a){this.reset();this._rawData=a;this._data=this.readData(this._rawData)},reset:function(){this.readObjectCache=[];this.readStringCache=[];this.readTraitsCache=[];this.writeStringCache=[];this.writeObjectCache=[];this.writeTraitsCache=[]},readData:function(a,b){var c=a.readByte();
switch(c){case 0:return this.readUndefined();case 1:return this.readNull();case 2:return this.readBoolean(!1);case 3:return this.readBoolean(!0);case 4:return this.readInt(a);case 5:return this.readDouble(a);case 6:return this.readString(a);case 7:return this.readXMLDoc(a);case 8:return this.readDate(a);case 9:return this.readArray(a);case 10:return this.readObject(a,b);case 11:return this.readXML(a);case 12:return this.readByteArray(a);case 13:return this.readVectorInt(a);case 14:return this.readVectorUInt(a);
case 15:return this.readVectorDouble(a);case 16:return this.readVectorObject(a);case 17:return this.readDictionary(a);default:throw Error("Undefined AMF3 type encountered '"+c+"'");}},writeData:function(a,b){var c=b.__traits.type;b.__traits.hasOwnProperty("origType")&&(c=b.__traits.origType);p("writeData",c,b);switch(c){case "Undefined":this.writeUndefined(a);break;case "Null":this.writeNull(a);break;case "False":this.writeBoolean(a,!1);break;case "True":this.writeBoolean(a,!0);break;case "Integer":this.writeInt(a,
b.value);break;case "Number":this.writeDouble(a,b.value);break;case "String":a.writeByte(6);this.writeString(a,b.value);break;case "XMLDocument":this.writeXMLDoc(a,b.value);break;case "Date":this.writeDate(a,b.value);break;case "Array":this.writeArray(a,b.value);break;case "Object":this.writeObject(a,b.value,b.__traits);break;case "XML":this.writeXML(a,b.value);break;case "ByteArray":this.writeByteArray(a,b.value);break;case "Vector.<int>":this.writeVectorInt(a,b.value,b.__traits);break;case "Vector.<uint>":this.writeVectorUInt(a,
b.value,b.__traits);break;case "Vector.<Number>":this.writeVectorDouble(a,b.value,b.__traits);break;case "Vector.<Object>":this.writeVectorObject(a,b.value,b.__traits);break;case "Dictionary":this.writeDictionary(a,b.value,b.__traits);break;default:throw Error("Undefined AMF3 type encountered '"+c+"'");}},readUInt29:function(a){var b=0,c=a.readUnsignedByte();if(128>c)return c;b=(c&127)<<7;c=a.readUnsignedByte();if(128>c)return b|c;b=(b|c&127)<<7;c=a.readUnsignedByte();if(128>c)return b|c;b=(b|c&127)<<
8;c=a.readUnsignedByte();return b|c},writeUInt29:function(a,b){if(128>b)a.writeByte(b);else if(16384>b)a.writeByte(b>>7&127|128),a.writeByte(b&127);else if(2097152>b)a.writeByte(b>>14&127|128),a.writeByte(b>>7&127|128),a.writeByte(b&127);else if(1073741824>b)a.writeByte(b>>22&127|128),a.writeByte(b>>15&127|128),a.writeByte(b>>8&127|128),a.writeByte(b&255);else throw Error("Integer out of range: "+b);},readUndefined:function(){return{value:null,__traits:{type:"Undefined"}}},writeUndefined:function(a){a.writeByte(0)},
readNull:function(){return{value:null,__traits:{type:"Null"}}},writeNull:function(a){a.writeByte(1)},readBoolean:function(a){return{value:a?1:0,__traits:{type:a?"True":"False"}}},writeBoolean:function(a,b){console.log("writeBoolean",b);a.writeByte(b?3:2)},readInt:function(a){a=this.readUInt29(a);return{value:a<<3>>3,__traits:{type:"Integer"}}},writeInt:function(a,b){-268435456<=b&&268435455>=b&&0==b%1?(b&=536870911,a.writeByte(4),this.writeUInt29(a,b)):this.writeDouble(a,b)},readDouble:function(a){return{value:a.readDouble(),
__traits:{type:"Number"}}},writeDouble:function(a,b){a.writeByte(5);a.writeDouble(b)},readString:function(a){var b=this.readUInt29(a);if(0==(b&1))return this.getStringReference(b>>1);var b=b>>1,c={value:"",__traits:{type:"String"}};0<b&&(c.value=a.readUTFBytes(b),this.readStringCache.push(c));return c},writeString:function(a,b,c){void 0===c&&(c=!0);if(""==b)a.writeByte(1);else{var d=new ByteArray;d.writeUTFBytes(b);d=d.length;c?this.setStringReference(a,b)&&(this.writeUInt29(a,d<<1|1),a.writeUTFBytes(b)):
(this.writeUInt29(a,d<<1|1),a.writeUTFBytes(b))}},readXMLDoc:function(a){var b=this.readUInt29(a);if(0==(b&1))return this.getObjectReference(b>>1);a={value:a.readUTFBytes(b>>1),__traits:{type:"XMLDocument"}};this.readObjectCache.push(a);return a},writeXMLDoc:function(a,b){a.writeByte(7);if(this.setObjectReference(a,b)){var c=b.toString(),c=c.replace(/^\s+|\s+$/g,""),c=c.replace(/\>(\n|\r|\r\n| |\t)*\</g,"><");this.writeString(a,c,!1)}},readDate:function(a){var b=this.readUInt29(a);if(0==(b&1))return this.getObjectReference(b>>
1);a={value:new Date(a.readDouble()),__traits:{type:"Date"}};this.readObjectCache.push(a);return a},writeDate:function(a,b){a.writeByte(8);b instanceof Date||(b=new Date(b));this.setObjectReference(a,b)&&(this.writeUInt29(a,1),a.writeDouble(b.getTime()))},readArray:function(a){var b=this.readUInt29(a);if(0==(b&1))return this.getObjectReference(b>>1);for(var c=[],d=!0,e=this.readString(a).value;""!=e;)c[e]=this.readData(a),e=this.readString(a).value,d=!1;b>>=1;for(e=0;e<b;e++)c[e]=this.readData(a);
a={value:c,__traits:{type:"Array",strict:d}};this.readObjectCache.push(a);return a},writeArray:function(a,b){var c=[],d={},e=b.length,f=0,g,m=!1,h=!1,h=0;for(g in b)f++,!isNaN(g)&&0<=g?c[g]=b[g]:(d[g]=b[g],h++);m=Boolean(f<e);h=Boolean(0<h);a.writeByte(9);if(this.setObjectReference(a,b))if(h||m){this.writeUInt29(a,1);for(g in b)this.writeString(a,g),this.writeData(a,b[g]);this.writeString(a,"")}else{e=c.length;this.writeUInt29(a,e<<1|1);for(g in d)this.writeString(a,g),this.writeData(a,d[g]);this.writeString(a,
"");for(d=0;d<e;d++)this.writeData(a,c[d])}},readObject:function(a,b){var c=this.readUInt29(a);if(0==(c&1))return this.getObjectReference(c>>1);var d;if(1==(c&3))d=this.getTraitReference(c>>2);else{d=4==(c&4);for(var e=8==(c&8),f=this.readString(a).value,c=c>>4,g=[],m=0;m<c;++m)g.push(this.readString(a).value);0==f.length&&(f="Object");d={type:"Object","class":f,members:g,count:c,externalizable:d,dynamic:e};this.readTraitsCache.push(d)}e=r[d.class];null!=e&&(d.class=e);e={};if(d.externalizable)try{if(0==
d.class.indexOf("flex."))var h=d.class.split("."),k=h[h.length-1],e=k&&AMF3.Flex[k]?(new AMF3.Flex[k]).readExternal(a,this):this.readData(a);else e["??? Warning: Externalized ???"]=this.readData(a),q("Externalized object ("+d.class+") encountered. Any data parsed after object will most likely be incorrect.<br>Saving this file after opening will most generate a corrupted file.")}catch(l){q("Unable to read externalizable data type '"+d.class+"'  |  "+l),e["??? Warning: Externalized ???"]={value:"Unable to read externalizable data type '"+
d.class+"'",__type:"String"}}else{k=d.members.length;for(f=0;f<k;++f)c=this.readData(a),h=d.members[f],e[h]=c;if(d.dynamic)for(h=this.readString(a).value;""!=h;)k=this.readData(a),e[h]=k,h=this.readString(a).value}if(b)return e;c={};c.__traits=d;c.value=e;this.readObjectCache.push(c);return c},writeObject:function(a,b,c){a.writeByte(10);var d;if(this.setTraitReference(a,c)&&(this.writeUInt29(a,3|(c.externalizable?4:0)|(c.dynamic?8:0)|c.count<<4),"Object"!=c.class?this.writeString(a,c.class):this.writeString(a,
""),!c.externalizable&&0<c.count))for(d in c.members)this.writeString(a,c.members[d]);if(c.externalizable)try{if(0==c.class.indexOf("flex.")){var e=c.class.split("."),f=e[e.length-1];f&&flex[f]?(new flex[f]).writeExternal(a,this,b):this.writeData(a,b)}}catch(g){throw Error("AMF3::writeObject - Error : Unable to write externalizable data type '"+c.class+"' | "+g);}else{if(this.setObjectReference(a,b))if("Object"!=c.class||!1==c.dynamic)for(d in c.members)this.writeData(a,b[c.members[d]]);else for(d in b)this.writeString(a,
d),this.writeData(a,b[d]);c.dynamic&&a.writeByte(1)}},readXML:function(a){var b=this.readUInt29(a);if(0==(b&1))return this.getObjectReference(b>>1);a={value:a.readUTFBytes(b>>1),__traits:{type:"XML"}};this.readObjectCache.push(a);return a},writeXML:function(a,b){a.writeByte(11);if(this.setObjectReference(a,b)){var c;c=b.replace(/^\s+|\s+$/g,"");this.writeString(a,c,!1)}},readByteArray:function(a){var b=this.readUInt29(a);if(0==(b&1))return this.getObjectReference(b>>1);for(var b=b>>1,c=[];b--;){var d=
a.readUnsignedByte();c.push(d)}a={value:c,__traits:{type:"ByteArray"}};this.readObjectCache.push(a);return a},writeByteArray:function(a,b){a.writeByte(12);this.setObjectReference(a,b)&&(this.writeUInt29(a,b.length<<1|1),a.writeBytes(b))},readVectorInt:function(a){var b=this.readUInt29(a);if(0==(b&1))return this.getObjectReference(b>>1);for(var b=b>>1,c=[],d=Boolean(a.readBoolean()),e=0;e<b;e++)c[e]={value:a.readInt(),__traits:{type:"Integer"}};a={value:c,__traits:{fixed:d,type:"Vector.<int>","class":"int"}};
this.readObjectCache.push(a);return a},writeVectorInt:function(a,b,c){a.writeByte(13);if(this.setObjectReference(a,b)){this.writeUInt29(a,b.length<<1|1);a.writeBoolean(c.fixed?1:0);c=0;for(var d=b.length;c<d;c++)a.writeInt(b[c].value)}},readVectorUInt:function(a){var b=this.readUInt29(a);if(0==(b&1))return this.getObjectReference(b>>1);for(var b=b>>1,c=[],d=Boolean(a.readBoolean()),e=0;e<b;e++)c[e]={value:a.readUnsignedInt(),__traits:{type:"Integer"}};a={value:c,__traits:{fixed:d,type:"Vector.<uint>",
"class":"uint"}};this.readObjectCache.push(a);return a},writeVectorUInt:function(a,b,c){a.writeByte(14);if(this.setObjectReference(a,b)){this.writeUInt29(a,b.length<<1|1);a.writeBoolean(c.fixed?1:0);c=0;for(var d=b.length;c<d;c++)a.writeUnsignedInt(b[c].value)}},readVectorDouble:function(a){var b=this.readUInt29(a);if(0==(b&1))return this.getObjectReference(b>>1);for(var b=b>>1,c=[],d=Boolean(a.readBoolean()),e=0;e<b;e++)c[e]={value:a.readDouble(),__traits:{type:"Number"}};a={value:c,__traits:{fixed:d,
type:"Vector.<Number>","class":"Number"}};this.readObjectCache.push(a);return a},writeVectorDouble:function(a,b,c){a.writeByte(15);if(this.setObjectReference(a,b)){this.writeUInt29(a,b.length<<1|1);a.writeBoolean(c.fixed?1:0);c=0;for(var d=b.length;c<d;c++)a.writeDouble(b[c].value)}},readVectorObject:function(a){var b=this.readUInt29(a);if(0==(b&1))return this.getObjectReference(b>>1);var b=b>>1,c=[],d=Boolean(a.readBoolean()),e=this.readString(a).value;0==e.length&&(e="Object");d={type:"Vector.<"+
e+">",fixed:d,"class":e};e=r[d.class];null!=e&&(d.class=e);for(e=0;e<b;e++)c[e]=this.readData(a);a={value:c,__traits:d};this.readObjectCache.push(a);return a},writeVectorObject:function(a,b,c){a.writeByte(16);if(this.setObjectReference(a,b)){this.writeUInt29(a,b.length<<1|1);a.writeBoolean(c.fixed?1:0);c=c.class;"Object"==c?this.writeString(a,""):this.writeString(a,c);c=0;for(var d=b.length;c<d;c++)this.writeData(a,b[c])}},readDictionary:function(a){var b=this.readUInt29(a);if(0==(b&1))return this.getObjectReference(b>>
1);for(var c=b>>1,b=[],d=Boolean(a.readBoolean()),e=0;e<c;e++)b[e]={key:this.readData(a),value:this.readData(a),__traits:{type:"DictionaryItem"}};a={value:b,__traits:{weakKeys:d,type:"Dictionary"}};this.readObjectCache.push(b);return a},writeDictionary:function(a,b,c){a.writeByte(17);if(this.setObjectReference(a,b)){var d=b.length;this.writeUInt29(a,d<<1|1);a.writeBoolean(c.weakKeys);for(c=0;c<d;c++)this.writeData(a,b[c].key),this.writeData(a,b[c].value)}},getStringReference:function(a){return a>=
this.readStringCache.length?(l("Warning: Undefined string reference '"+a+"'"),{value:"??? Error: Str Ref #"+a+" ???",__traits:{type:"String",missingRef:a}}):this.readStringCache[a]},setStringReference:function(a,b){var c;if(null!=this.writeStringCache&&-1!=(c=this.writeStringCache.indexOf(b)))return this.writeUInt29(a,c<<1),!1;null==this.writeStringCache&&(this.writeStringCache=[]);this.writeStringCache.push(b);return!0},getTraitReference:function(a){return a>=this.readTraitsCache.length?(l("Warning: Undefined trait reference '"+
a+"'"),{value:"??? Error: Trait Ref #"+a+" ???",__traits:{type:"String",missingRef:a}}):this.readTraitsCache[a]},setTraitReference:function(a,b){var c,d=JSON.stringify(b);if(null!=this.writeTraitsCache&&-1!=(c=this.writeTraitsCache.indexOf(d)))return this.writeUInt29(a,c<<2|1),!1;null==this.writeTraitsCache&&(this.writeTraitsCache=[]);this.writeTraitsCache.push(d);return!0},getObjectReference:function(a){return a>=this.readObjectCache.length?(l("Warning: Undefined object reference '"+a+"'"),{value:"??? Error: Obj Ref #"+
a+" ???",__traits:{type:"String",missingRef:a}}):this.readObjectCache[a]},setObjectReference:function(a,b){var c,d=this.cleanObject(b,{});if(null!=this.writeObjectCache&&-1!=(c=this.cacheIndexOf(this.writeObjectCache,d)))return this.writeUInt29(a,c<<1),!1;null==this.writeObjectCache&&(this.writeObjectCache=[]);this.writeObjectCache.push(d);return!0},cacheIndexOf:function(a,b){for(var c=0,d=a.length;c<d;c++)if(p(a[c],b,a[c]===b),a[c]===b)return c;return-1},cleanObject:function(a,b){for(var c in a){var d=
a[c].value;"string"==typeof d||"number"==typeof d||"boolean"==typeof d?b[c]=d:Array.isArray(d)?b[c]=this.cleanObject(a[c].value,[]):b[c]=this.cleanObject(a[c].value,{})}return b}};AMF3.Flex={};var n={UPPER_DIGITS:"0123456789ABCDEF".split(""),fromByteArray:function(a){if(null!=a&&16==a.length){for(var b="",c=0;16>c;c++){if(4==c||6==c||8==c||10==c)b+="-";b+=this.UPPER_DIGITS[(+a[c]&240)>>>4];b+=this.UPPER_DIGITS[+a[c]&15]}return b}return null}};AMF3.Flex.AbstractMessage=function(){this.body=this.headers=
this.timeToLive=this.timestamp=this.messageId=this.destination=this.clientId=null};AMF3.Flex.AbstractMessage.prototype={readExternal:function(a,b){for(var c=this.readFlags(a),d=0;d<c.length;d++){var e=c[d],f=0;0==d?(0!=(e&1)&&this.readExternalBody(a,b),0!=(e&2)&&(this.clientId=b.readData(a)),0!=(e&4)&&(this.destination=b.readData(a)),0!=(e&8)&&(this.headers=b.readData(a)),0!=(e&16)&&(this.messageId=b.readData(a)),0!=(e&32)&&(this.timestamp=b.readData(a)),0!=(e&64)&&(this.timeToLive=b.readData(a)),
f=7):1==d&&(0!=(e&1)&&(f=b.readData(a),this.clientId=n.fromByteArray(f)),0!=(e&2)&&(f=b.readData(a),this.messageId=n.fromByteArray(f)),f=2);if(0!=e>>f)for(;6>f;f++)0!=(e>>f&1)&&b.readData(a)}return this},readExternalBody:function(a,b){this.body=b.readData(a)},readFlags:function(a){for(var b=!0,c=[],d=0;b;)b=a.readUnsignedByte(),c[d]=b,b=0!=(b&128)?!0:!1,d++;return c}};AMF3.Flex.AsyncMessage=function(){this.correlationId=null};AMF3.Flex.AsyncMessage.prototype=new AMF3.Flex.AbstractMessage;AMF3.Flex.AsyncMessage.constructor=
AMF3.Flex.AsyncMessage;AMF3.Flex.AsyncMessage.prototype.readExternal=function(a,b){AMF3.Flex.AbstractMessage.prototype.readExternal.call(this,a,b);for(var c=this.readFlags(a),d=0;d<c.length;d++){var e=c[d],f=0;0==d&&(0!=(e&1)&&(this.correlationId=b.readData(a)),0!=(e&2)&&(f=b.readData(a),this.correlationId=n.fromByteArray(f)),f=2);if(0!=e>>f)for(;6>f;++f)0!=(e>>f&1)&&b.readData(a)}return this};AMF3.Flex.AsyncMessageExt=function(){};AMF3.Flex.AsyncMessageExt.prototype=new AMF3.Flex.AsyncMessage;AMF3.Flex.AsyncMessageExt.constructor=
AMF3.Flex.AsyncMessageExt;AMF3.Flex.AcknowledgeMessage=function(){};AMF3.Flex.AcknowledgeMessage.prototype=new AMF3.Flex.AsyncMessage;AMF3.Flex.AcknowledgeMessage.constructor=AMF3.Flex.AcknowledgeMessage;AMF3.Flex.AcknowledgeMessage.prototype.readExternal=function(a,b){AMF3.Flex.AsyncMessage.prototype.readExternal.call(this,a,b);for(var c=this.readFlags(a),d=0;d<c.length;++d){var e=c[d];if(0!=e>>0)for(var f=0;6>f;++f)0!=(e>>f&1)&&b.readData(a)}return this};AMF3.Flex.AcknowledgeMessageExt=function(){};
AMF3.Flex.AcknowledgeMessageExt.prototype=new AMF3.Flex.AcknowledgeMessage;AMF3.Flex.AcknowledgeMessageExt.constructor=AMF3.Flex.AcknowledgeMessageExt;AMF3.Flex.CommandMessage=function(){this.operation=1E3;this.operationName="unknown"};AMF3.Flex.CommandMessage.prototype=new AMF3.Flex.AsyncMessage;AMF3.Flex.CommandMessage.constructor=AMF3.Flex.CommandMessage;AMF3.Flex.CommandMessage.prototype.readExternal=function(a,b){AMF3.Flex.AsyncMessage.prototype.readExternal.call(this,a,b);for(var c=this.readFlags(a),
d=0;d<c.length;++d){var e=c[d],f=0,g="subscribe unsubscribe poll unused3 client_sync client_ping unused6 cluster_request login logout subscription_invalidate multi_subscribe disconnect trigger_connect".split(" ");0==d&&(0!=(e&1)&&(this.operation=b.readData(a),this.operationName=0>this.operation||this.operation>=g.length?"invalid."+operation+"":g[operation]),f=1);if(0!=e>>f)for(;6>f;++f)0!=(e>>f&1)&&b.readData(a)}return this};AMF3.Flex.CommandMessageExt=function(){};AMF3.Flex.CommandMessageExt.prototype=
new AMF3.Flex.CommandMessage;AMF3.Flex.CommandMessageExt.constructor=AMF3.Flex.CommandMessageExt;AMF3.Flex.ErrorMessage=function(){};AMF3.Flex.ErrorMessage.prototype=new AMF3.Flex.AcknowledgeMessage;AMF3.Flex.ErrorMessage.constructor=AMF3.Flex.ErrorMessage;AMF3.Flex.ArrayCollection=function(){this.source=null};AMF3.Flex.ArrayCollection.prototype.readExternal=function(a,b){this.source=b.readData(a);return this};AMF3.Flex.ArrayList=function(){};AMF3.Flex.ArrayList.prototype=new AMF3.Flex.ArrayCollection;
AMF3.Flex.ArrayList.constructor=AMF3.Flex.ArrayList;AMF3.Flex.ObjectProxy=function(){};AMF3.Flex.ObjectProxy.prototype.readExternal=function(a,b){var c=b.readData(a,!0),d;for(d in c)this[d]=c[d];return this};AMF3.Flex.ManagedObjectProxy=function(){};AMF3.Flex.ManagedObjectProxy.prototype=new AMF3.Flex.ObjectProxy;AMF3.Flex.ManagedObjectProxy.constructor=AMF3.Flex.ManagedObjectProxy;AMF3.Flex.SerializationProxy=function(){this.defaultInstance=null};AMF3.Flex.SerializationProxy.prototype.readExternal=
function(a,b){this.defaultInstance=b.readData(a);return this}})();
