(function(){function l(){for(var a=[],b=0,c=arguments.length;b<c;b++)a[b]=arguments[b];postMessage({type:"debug",message:a})}var h=String.fromCharCode,k=Math.pow;k(2,-23);ByteArray=function(a,b){void 0==a?(a=new ArrayBuffer(5242880),this.length=0):this.length=a.byteLength;this.position=0;this.endian=void 0!==b?b:ByteArray.BIG_ENDIAN;this._bitBuffer=null;this._bitPosition=8;this._buffer=a;this._dataview=new DataView(this._buffer);var c={readUnsignedByte:"readUI8",readUnsignedShort:"readUI16",readUnsignedInt:"readUI32",
readByte:"readSI8",readShort:"readSI16",readInt:"readSI32",readBoolean:"readUI8",writeUnsignedByte:"writeUI8",writeUnsignedShort:"writeUI16",writeUnsignedInt:"writeUI32",writeByte:"writeSI8",writeShort:"writeSI16",writeInt:"writeSI32",writeBoolean:"writeUI8"},d;for(d in c)this[d]=this[c[d]]};ByteArray.BIG_ENDIAN="bigEndian";ByteArray.LITTLE_ENDIAN="littleEndian";ByteArray.prototype={resizeBuffer:function(a){a=new ArrayBuffer(a);(new Int8Array(a)).set(new Int8Array(this._buffer));this._buffer=a;this._dataview=
new DataView(a)},getBytesAvailable:function(){return this.length-this.position},seek:function(a,b){this.position=(b?0:this.position)+a;this.align();return this},readBytes:function(a){a=(this.position+=a)-a;return this._dataview.slice(a,this.position)},writeBytes:function(a){var b,c;l("writeBytes",Array.isArray(a));b=Array.isArray(a)?a:new Int8Array(a._dataview.buffer);for(c=0;c<a.length;c++)this.writeByte(b[c])},readByteAt:function(a){return this._dataview[a]},writeByteAt:function(a,b){this._dataview[a]=
b},readSI8:function(){var a=this._dataview.getInt8(this.position);this.position+=1;this.align();return a},writeSI8:function(a){a=this._dataview.setInt8(this.position,parseInt(a));this.position+=1;this.length+=1;this.align();return a},readSI16:function(a){a=this._dataview.getInt16(this.position,a);this.position+=2;this.align();return a},writeSI16:function(a,b){var c=this._dataview.setInt16(this.position,a,b);this.position+=2;this.length+=2;this.align();return c},readSI32:function(a){a=this._dataview.getInt32(this.position,
a);this.position+=4;this.align();return a},writeSI32:function(a,b){var c=this._dataview.setInt32(this.position,a,b);this.position+=4;this.length+=4;this.align();return c},readUI8:function(){var a=this._dataview.getUint8(this.position);this.position+=1;this.align();return a},writeUI8:function(a){a=this._dataview.setUint8(this.position,parseInt(a));this.position+=1;this.length+=1;this.align();return a},readUI16:function(a){a=this._dataview.getUint16(this.position,a);this.position+=2;this.align();return a},
writeUI16:function(a,b){var c=this._dataview.setUint16(this.position,a,b);this.position+=2;this.length+=2;this.align();return c},readUI32:function(a){a=this._dataview.getUint32(this.position,a);this.position+=4;this.align();return a},writeUI32:function(a,b){var c=this._dataview.setUint32(this.position,a,b);this.position+=4;this.length+=4;this.align();return c},_readFixedPoint:function(a,b){return this.readSB(a)*k(2,-b)},readFixed:function(){return this._readFixedPoint(32,16)},readFixed8:function(){return this._readFixedPoint(16,
8)},readFB:function(a){return this._readFixedPoint(a,16)},readFloat:function(a){a=this._dataview.getFloat32(this.position,a);this.position+=4;this.align();return a},writeFloat:function(a,b){var c=this._dataview.setFloat32(this.position,a,b);this.position+=4;this.length+=4;this.align();return c},readDouble:function(a){a=this._dataview.getFloat64(this.position,a);this.position+=8;this.align();return a},writeDouble:function(a,b){var c=this._dataview.setFloat64(this.position,a,b);this.position+=8;this.length+=
8;this.align();return c},readEncodedU32:function(){for(var a=0,b=0;5>b;b++){var c=this.readByteAt(this.position++),a=a|(c&127)<<7*b;if(!(c&128))break}return a},align:function(){this._bitPosition=8;this._bitBuffer=null},readUB:function(a,b){for(var c=0,d=0;d<a;d++)8==this._bitPosition&&(this._bitBuffer=this.readUI8(),this._bitPosition=0),c=b?c|(this._bitBuffer&1<<this._bitPosition++?1:0)<<d:c<<1|(this._bitBuffer&128>>this._bitPosition++?1:0);return c},writeUB:function(a,b){if(0!=b){0==this._bitPosition&&
(this._bitPosition=8);for(;0<b;){for(;0<this._bitPosition&&0<b;)0!=(a&1<<b-1)&&(this._bitBuffer|=1<<this._bitPosition-1),--b,--this._bitPosition;0==this._bitPosition&&(this.writeUI8(this._bitBuffer),this._bitBuffer=0,0<b&&(this._bitPosition=8))}}},readSB:function(a){if(!a)return 0;var b=this.readUB(a);return 1==b>>>a-1?-((~b&-1>>>-a)+1):b},writeSB:function(a,b){writeUB(a|(0>a?2147483648:0)>>32-b,b)},readUTFChar:function(){function a(){this.position-=3;return d()}function b(){this.position-=2;return d()}
function c(){this.position-=1;return d()}function d(){return String.fromCharCode(e+56320)}var e,f,g,h;e=this.readUI8();if(128>e)return String.fromCharCode(e);if(194>e)return d();if(224>e)return f=this.readUI8(),128!=(f&192)?c():String.fromCharCode((e<<6)+f-12416);if(240>e){f=this.readUI8();if(128!=(f&192)||224==e&&160>f)return c();g=this.readUI8();return 128!=(g&192)?b():String.fromCharCode((e<<12)+(f<<6)+g-925824)}if(245>e){f=this.readUI8();if(128!=(f&192)||240==e&&144>f||244==e&&144<=f)return c();
g=this.readUI8();if(128!=(g&192))return b();h=this.readUI8();return 128!=(h&192)?a():String.fromCharCode((e<<18)+(f<<12)+(g<<6)+h-63447168)}return d()},writeUTFChar:function(a){a=a.charCodeAt(0);if(128>a)this.writeUI8(a);else if(2047>=a)this.writeUI8((a>>6)+192),this.writeUI8((a&63)+128);else if(65535>=a)this.writeUI8((a>>12)+224),this.writeUI8((a>>6&63)+128),this.writeUI8((a&63)+128);else if(1114111>=a)this.writeUI8((a>>18)+240),this.writeUI8((a>>12&63)+128),this.writeUI8((a>>6&63)+128),this.writeUI8((a&
63)+128);else throw error("writeUTFChar: Invalid char code");},readUTFBytes:function(a,b){for(var c=null,c=[],d=this.position+a;this.position<d;)c.push(this.readUTFChar(b));return c=c.join("")},writeUTFBytes:function(a){var b=a.split("");for(a=a.length;a--;)this.writeUTFChar(b.shift())},readUTF:function(){var a=this.readUI16();return this.readUTFBytes(a)},writeUTF:function(a){var b=this.position;this.writeUI16(a.length);this.writeUTFBytes(a);this._dataview.setUint16(b,this.position-b-2)},readString:function(a,
b){var c=this._dataview,d=null;if(void 0!=a)d=c.substr(this.position,a),this.position+=a;else{c=[];for(d=this.length-this.position;d--;){var e=this.readByteAt(this.position++),f,g;if(e)b?c.push(h(e)):128>e?c.push(h(e)):191<e&&224>e?(f=this.readByteAt(this.position++),c.push(h((e&31)<<6|f&63)),d--):(f=this.readByteAt(this.position++),g=this.readByteAt(this.position++),c.push(h((e&15)<<12|(f&63)<<6|g&63)),d-=2);else break}d=c.join("")}return d}}})();
